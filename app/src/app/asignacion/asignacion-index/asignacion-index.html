<div class="actions-header">

    <!-- Botón de AutoTriage -->
    <button mat-flat-button class="btn-autotriage" (click)="irAutotriage()">
        <mat-icon>bolt</mat-icon>
        Ejecutar AutoTriage
    </button>

</div>


<div class="grid-container">
    @if (datos().length > 0) {

    <!-- Agrupación por día -->
    @for (dia of diasUnicos(datos()); track dia) {
    <div class="dia-header">
        <h2>{{ traducirDia(dia) | translate }}</h2>
    </div>

    <div class="asignacion-list">

        @for (item of filtrarPorDia(dia); track item.id) {
        <div class="asignacion-card" [ngClass]="estadoColor(item.estado)">
            <mat-card class="asignacion-mat-card">

                <!-- Cabecera -->
                <div class="card-header">

                    <mat-icon class="icono-categoria">
                        {{
                        item.categoria === 'Soporte de Red' ? 'wifi' :
                        item.categoria === 'Soporte de Hardware' ? 'memory' :
                        item.categoria === 'Soporte de Software' ? 'code' :
                        item.categoria === 'Correo Institucional' ? 'email' :
                        item.categoria.includes('VPN') ? 'vpn_key' :
                        'assignment'
                        }}
                    </mat-icon>

                    <div class="info">
                        <h3>{{ item.titulo }}</h3>
                        <p class="categoria">{{ item.categoria }}</p>
                    </div>
                </div>

                <!-- Cuerpo -->
                <div class="card-body">
                    <p><strong>{{ 'ASSIGNMENTS.ID' | translate }}:</strong> {{ item.id }}</p>
                    <p><strong>{{ 'ASSIGNMENTS.STATUS' | translate }}:</strong> {{ item.estado }}</p>
                    <p><strong>{{ 'ASSIGNMENTS.TECHNICIAN' | translate }}:</strong> {{ item.tecnico }}</p>

                    <p>
                        <strong>{{ 'ASSIGNMENTS.SLA_REMAINING' | translate }}:</strong>
                        {{ item.slaRestanteHoras }} h
                    </p>

                    <!-- Barra de SLA -->
                    <mat-progress-bar mode="determinate" [value]="calcularSLAProgreso(item.slaRestanteHoras)"
                        color="accent">
                    </mat-progress-bar>
                </div>

                <!-- Footer con acciones -->
                <div class="card-footer acciones-rapidas">

                    <!-- Ver detalle -->
                    <button mat-icon-button [matTooltip]="'ASSIGNMENTS.TOOLTIP_DETAIL' | translate"
                        (click)="verDetalle(item.id)">
                        <mat-icon>info</mat-icon>
                    </button>

                    <!-- Cambiar estado -->
                    <button mat-icon-button [matTooltip]="'ASSIGNMENTS.TOOLTIP_STATUS' | translate">
                        <mat-icon>sync</mat-icon>
                    </button>

                    <!-- Comentario -->
                    <button mat-icon-button [matTooltip]="'ASSIGNMENTS.TOOLTIP_COMMENT' | translate">
                        <mat-icon>comment</mat-icon>
                    </button>

                </div>

            </mat-card>
        </div>
        }

    </div>
    }
    }
    @else {
    <div>
        <p>{{ 'ASSIGNMENTS.EMPTY' | translate }}</p>
    </div>
    }
</div>