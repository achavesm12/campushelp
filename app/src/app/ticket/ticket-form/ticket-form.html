<form [formGroup]="ticketForm" (ngSubmit)="submitTicket()" novalidate>

    <div class="detail-container">
        <mat-card class="detail-card">

            <mat-card class="form-card">
                <mat-card-header class="primary-title title">
                    <mat-card-title>
                        {{ titleForm | translate }}
                    </mat-card-title>
                </mat-card-header>

                <mat-card-content>

                    <!-- titulo ticket -->
                    <div class="row">
                        <div class="col">
                            <mat-form-field class="full-width" floatLabel="auto">
                                <mat-label>{{ 'TICKETS.FORM.TITLE' | translate }}</mat-label>

                                <input matInput formControlName="titulo"
                                    [placeholder]="'TICKETS.FORM.TITLE_PLACEHOLDER' | translate" />

                                @if (ticketForm.controls['titulo'].invalid && ticketForm.controls['titulo'].touched) {
                                <mat-error>
                                    @if (ticketForm.controls['titulo'].errors?.['required']) {
                                    {{ 'TICKETS.FORM.TITLE_REQUIRED' | translate }}
                                    }
                                    @if (ticketForm.controls['titulo'].errors?.['minlength']) {
                                    {{ 'TICKETS.FORM.TITLE_MIN' | translate }}
                                    }
                                </mat-error>
                                }
                            </mat-form-field>
                        </div>
                    </div>

                    <!-- descripción -->
                    <div class="row">
                        <div class="col">
                            <mat-form-field class="full-width" floatLabel="auto">
                                <mat-label>{{ 'TICKETS.FORM.DESCRIPTION' | translate }}</mat-label>

                                <textarea matInput formControlName="descripcion" rows="4"
                                    [placeholder]="'TICKETS.FORM.DESCRIPTION_PLACEHOLDER' | translate">
                                </textarea>

                                @if (ticketForm.controls['descripcion'].invalid &&
                                ticketForm.controls['descripcion'].touched) {

                                <mat-error>
                                    @if (ticketForm.controls['descripcion'].errors?.['required']) {
                                    {{ 'TICKETS.FORM.DESCRIPTION_REQUIRED' | translate }}
                                    }
                                    @if (ticketForm.controls['descripcion'].errors?.['minlength']) {
                                    {{ 'TICKETS.FORM.DESCRIPTION_MIN' | translate }}
                                    }
                                </mat-error>

                                }
                            </mat-form-field>
                        </div>
                    </div>

                    <!-- prioridad -->
                    <div class="row">
                        <div class="col">
                            <mat-form-field class="full-width" floatLabel="auto">
                                <mat-label>{{ 'TICKETS.FORM.PRIORITY' | translate }}</mat-label>

                                <mat-select formControlName="prioridadId"
                                    [placeholder]="'TICKETS.FORM.PRIORITY_PLACEHOLDER' | translate">

                                    @for (p of prioridadesList(); track p.id) {
                                    <mat-option [value]="p.id">{{ p.nombre }}</mat-option>
                                    }
                                </mat-select>

                                @if (ticketForm.controls['prioridadId'].invalid &&
                                ticketForm.controls['prioridadId'].touched) {

                                <mat-error>{{ 'TICKETS.FORM.PRIORITY_REQUIRED' | translate }}</mat-error>

                                }
                            </mat-form-field>
                        </div>
                    </div>

                    <!-- etiqueta -->
                    <div class="row">
                        <div class="col">
                            <mat-form-field class="full-width" floatLabel="auto">
                                <mat-label>{{ 'TICKETS.FORM.LABEL' | translate }}</mat-label>

                                <mat-select formControlName="etiquetaId"
                                    [placeholder]="'TICKETS.FORM.LABEL_PLACEHOLDER' | translate">

                                    @for (item of etiquetasList(); track item.id) {
                                    <mat-option [value]="item.id">{{ item.nombre }}</mat-option>
                                    }
                                </mat-select>

                                @if (ticketForm.controls['etiquetaId'].invalid &&
                                ticketForm.controls['etiquetaId'].touched) {

                                <mat-error>{{ 'TICKETS.FORM.LABEL_REQUIRED' | translate }}</mat-error>

                                }
                            </mat-form-field>
                        </div>
                    </div>

                    <!-- categoría calculada -->
                    <div class="row">
                        <div class="col">
                            <mat-form-field class="full-width" floatLabel="auto">
                                <mat-label>{{ 'TICKETS.FORM.CATEGORY' | translate }}</mat-label>

                                <input matInput formControlName="categoriaNombre"
                                    [placeholder]="'TICKETS.FORM.CATEGORY_PLACEHOLDER' | translate" />

                                @if (!categoriaSeleccionada()) {
                                <mat-hint>
                                    {{ 'TICKETS.FORM.CATEGORY_HINT' | translate }}
                                </mat-hint>
                                }
                            </mat-form-field>
                        </div>
                    </div>

                    <!-- información solicitante -->
                    <div class="row">
                        <div class="col">
                            <mat-form-field class="full-width" floatLabel="auto">
                                <mat-label>{{ 'TICKETS.FORM.REQUESTER' | translate }}</mat-label>
                                <input matInput formControlName="solicitanteNombre">
                            </mat-form-field>
                        </div>

                        <div class="col">
                            <mat-form-field class="full-width" floatLabel="auto">
                                <mat-label>{{ 'TICKETS.FORM.EMAIL' | translate }}</mat-label>
                                <input matInput formControlName="solicitanteEmail">
                            </mat-form-field>
                        </div>
                    </div>

                </mat-card-content>

                <mat-card-actions class="button-row">
                    <button matButton class="btn-tertiary" type="button" (click)="onReset()">
                        {{ 'COMMON.CLEAR' | translate }}
                    </button>

                    <button matButton class="btn-secondary" type="button" (click)="onBack()">
                        {{ 'COMMON.BACK' | translate }}
                    </button>

                    <button matButton class="btn-primary" type="submit" [disabled]="loading()">
                        {{ 'COMMON.SAVE' | translate }}
                    </button>
                </mat-card-actions>

            </mat-card>
        </mat-card>
    </div>

</form>